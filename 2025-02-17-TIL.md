# GIT TIL 58 - JSON Web Token, JWT

<br><br>

## JWT란 무엇일까?

![Image](https://github.com/user-attachments/assets/ffd52de5-cd02-4385-ba5f-3bc99fc6b150)

>  `쿠키`와 `세션`의 `단점을 보완`하기 위해 나온 ***토큰 기반 인증 방식*** 이다

<br>

## Session & Cookie

### 쿠키 (Cookie)
- 웹 브라우저와 요청과 응답을 주고받을 때 사용하는 데이터 조각
- 도메인에 제한적이며 유효기간이 정해져있음
- Auth 외에도 다양한 방식으로 활용

### 세션 (Session)
- stateless한 HTTP 특징을 보완하기 위한 방법
- 세션 DB를 이용해서 유저의 정보를 기억하며
- Session ID라고 하는 랜덤한 Key를 쿠키에 담아서 Auth에 활용
- 쿠키를 사용해서 Session ID를 주고 받는 것

<br>

## JSON Web Token, JWT

### 간단 개요
- Cookie는 웹 브라우저에만 존재하는 것으로 다양한 접자들과 공통적으로 사용할 수 있는 방식이 필요했다
- 이러한 방식으로 널리 사용되는 것이 바로 Token Auth, 그 중에서도 JWT 방식이 많이 사용된다

### 토큰의 특징
- 간단히 말해 랜덤하게 생긴 문자열이며
- 일정한 규칙을 가지고 있고 간단한 서명을 더한 문자열로 토큰 자체에 유저에 대한 정보가 들어있는 형태이다

> ### JWT 방식으로 Auth를 처리하면 세션 DB나 인증을 위한 여러가지 로직 처리가 필요 없다

<br>

## 처리방식

1. 클라이언트가 아이디 패스워드를 서버로 보낸다
2. 서버에서 아이디 패스워드를 검증하고 유효하다면 일정한 형식으로 서명 처리된 토큰을 응답한다
3. 이후 클라이언트는 모든 요청 헤더에 토큰을 담아 서버로 요청을 전송한다
4. 서버는 해당 토큰의 유효성을 검증하고 유저의 신원과 권한을 확인 후 요청을 처리한다

<br>

## 얼마나 안전한지 JWT 구조를 보자면

![Image](https://github.com/user-attachments/assets/cfce77fa-2ac1-4d19-9cf2-6a3172ef6499)

- `.` 을 기준으로 `HEADER` . `PAYLOAD` . `VERIFY SIGNATURE` 세 부분으로 구성

<br>

### HEADER
- 토큰의 타입(jwt) 또는 서명 부분의 생성에 어떤 `알고리즘(alg)`이 사용되었는지 등을 저장

### PAYLOAD
- 토큰 발급자, 토큰 대상자, 토큰 만료시간, 활성날짜, 발급시간 등등
- 여러 데이터가 담겨있는 부분
- 이곳에 서비스가 유저 정보를 담아서 인증
- 누구나 볼 수 있기 때문에 민감한 정보를 담지않고 최소의 정보만 저장
- 각각의 데이터는 `Claim`이라고도 하며 `Key-Value` 형태로 구성됨

### SIGNATURE
- HEADER + PAYLOAD + 서버의 비밀키 값을 HEADER에 명시된 `암호화 방식(alg)`으로 생성한 값
- 즉 PAYLOAD의 글자 하나만 달라져도 SIGNATURE는 완전히 다른 문자열로 변환된다.
- 생성한 서명값이 토큰의 서명값과 일치하는지를 확인하는 과정을 거쳐서 유효성 여부를 확인

<br>

### Access Token과 Refresh Token


#### 🔑 Access Token
- 요청할 때 인증을 위해 헤더에 포함해야하는 토큰입니다
- 매 요청시 보내는 토큰이므로 보안이 취약합니다
- 만료 기한을 짧게 잡아 만약 탈취 당해도 짧은 시간안에 유효하지 않은 토큰 형태가 됨

#### 🔄 Refresh Token
- Access Token이 만료되었을때 새로 Access Token을 발급받기 위한 Token
- Access Token 보다 긴 유효기간
- 만약 Refresh Token까지 만료되었다면 다시 인증(로그인)필요
- Refresh Token의 탈취를 보완하기 위해 DB 리소스를 사용하는 다양한 방식도 존재 (BlackList)

<br>

## 세션과의 차이

### 장점
- 서버에서 관리하는 데이터베이스가 존재하지 않으며 복잡한 처리 로직이 필요하지 않다
- 토큰 자체가 유저의 인증 데이터입니다

### 단점
- 일정적으로 로그인을 무효화하는 등의 처리가 불가능하다 (세션 데이터 X)
- 토큰 자체가 데이터를 담고 있는 정보이므로 탈취당시 보안이 취약하다

<br><br>

---

<br><br>




